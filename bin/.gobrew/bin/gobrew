#!/usr/bin/env ruby

arg = ARGV[0]
PATH="~/.gobrew/go"
URL="https://go.googlecode.com/files"

if arg == "here"
  current = Dir::pwd

template = <<EOS
export GOPATH=#{current}
export PATH=$PATH:$GOROOT/bin:$GOPATH/bin
EOS
  path = File::expand_path('~') + "/.gobrew/env/.gopath"
  env = File.open(path,'w')
  env.puts template
  env.close
end

if arg == "pkg"
  puts `tree $GOROOT/src/pkg -L 2 -d`
end

if arg == "list"
  puts `\ls #{PATH} | grep go | sed "s/go//"`
end

if arg == "use"
  version = ARGV[1]
  puts "use go"+version
  `rm #{PATH}/current`
  `ln -s #{PATH}/go#{version} #{PATH}/current`
end

if arg == "install"
  version = "go#{ARGV[1]}"
  `wget #{URL}/#{version}.linux-386.tar.gz #{PATH}`
  `tar zxvf #{PATH}/#{version}.linux-386.tar.gz`
  `mv #{PATH}/go #{PATH}/#{version}`
  `rm #{PATH}/#{version}.linux-386.tar.gz`
end

if arg == "version"
  info = `file #{PATH}/current`
  puts info.split('/').last.sub("'", "")
end
