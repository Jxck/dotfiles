#!/usr/bin/env ruby

require 'webrick'


# http://svn.ruby-lang.org/cgi-bin/viewvc.cgi/trunk/lib/webrick/httputils.rb?view=markup
mime = WEBrick::HTTPUtils::DefaultMimeTypes.merge({
  "js"       => "text/javascript",
  "json"     => "text/json",
  "log"      => "text/plain",
  "md"       => "text/plain",
  "markdown" => "text/plain",
})

header = {
  # 'Link' => '<http://localhost:3000/foo.css>; rel=preload;',
}

port = ARGV.shift || 3000
config = {
  :Port            => port,
  :DocumentRoot    => '.',
  :MimeTypes       => mime,
  :RequestCallback => lambda {|req, res|
    res.header.merge!(header)
  }
}

server = WEBrick::HTTPServer.new(config)
Signal.trap('INT') { server.shutdown }
server.start
