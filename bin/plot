#!/usr/bin/env ruby

########################################
# HELP
########################################
HELP=<<EOS
plot `uniq -c | sort -nr` result

$ plot [TRIM] [LIMIT]

$ cat access.log | sort | uniq -c | sort -nr
5738 /20
5057 /21
2714 /10
2643 /10
2595 /19
2533 /7
2507 /11
2478 /8
2399 /9
2352 /18
2343 /17
2290 /6
2107 /13
2095 /19
1694 /16
1564 /14
1354 /13
1327 /15
1319 /12
1257 /12

$ cat access.log | sort | uniq -c | sort -nr | plot 10 100
/20 *****************************************************************************************************
/21 ***************************************************************************************
/10 *******************************************
/10 ******************************************
/19 ****************************************
/7  **************************************
/11 **************************************
/8  *************************************
/9  ***********************************
/18 *********************************
/17 *********************************
/6  ********************************
/13 ***************************
/19 ****************************
/16 ****************
/14 *************
/13 ********
/15 *******
/12 ******
/12 ******
EOS

if ARGV[0] == "-h"
  puts HELP
  exit 0
end


########################################
# Main
########################################
TRIM = (ARGV[0] || 20).to_i
LIMIT = (ARGV[1] || 150).to_i
max = 0
STDIN.each_line.with_index{|line, i|
  count, label = line.split(" ")
  count = count.to_i
  label = label.slice(0..TRIM).ljust(TRIM)

  max = count if i == 0
  round = ((count*LIMIT)/max).round
  puts "#{label}\t#{'*' * round} #{count}"
}
